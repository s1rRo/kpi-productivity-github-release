<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPI Productivity - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .tab {
            padding: 12px 24px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #555;
        }

        .tab:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .diagram-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: none;
        }

        .diagram-container.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .diagram-container h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            background: #fafafa;
            padding: 20px;
            border-radius: 10px;
        }

        .info-box {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-box ul {
            list-style: none;
            padding-left: 0;
        }

        .info-box li {
            padding: 5px 0;
            padding-left: 25px;
            position: relative;
        }

        .info-box li:before {
            content: "‚úì";
            color: #667eea;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .tech-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 2px solid #f0f0f0;
            transition: all 0.3s ease;
        }

        .tech-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .tech-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .tech-card ul {
            list-style: none;
            padding: 0;
        }

        .tech-card li {
            padding: 5px 0;
            color: #666;
            font-size: 0.9em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8f9ff;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 0.85em;
            margin: 2px;
        }

        .badge.danger {
            background: #e74c3c;
        }

        .badge.success {
            background: #2ecc71;
        }

        .badge.warning {
            background: #f39c12;
        }

        footer {
            text-align: center;
            padding: 30px;
            color: white;
            margin-top: 40px;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .metric-card .number {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .metric-card .label {
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ KPI Productivity System</h1>
            <p class="subtitle">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="showDiagram('overview')">–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</button>
            <button class="tab" onclick="showDiagram('dataflow')">–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö</button>
            <button class="tab" onclick="showDiagram('security')">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</button>
            <button class="tab" onclick="showDiagram('deployment')">–î–µ–ø–ª–æ–π–º–µ–Ω—Ç</button>
            <button class="tab" onclick="showDiagram('scaling')">–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
            <button class="tab" onclick="showDiagram('tech')">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</button>
            <button class="tab" onclick="showDiagram('ports')">–ü–æ—Ä—Ç—ã –∏ –¥–æ—Å—Ç—É–ø</button>
        </div>

        <!-- Overview Diagram -->
        <div id="overview" class="diagram-container active">
            <h2>–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã</h2>
            <div class="mermaid">
graph TB
    subgraph "–ö–ª–∏–µ–Ω—Ç"
        Browser[üåê –ë—Ä–∞—É–∑–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]
    end

    subgraph "–í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø"
        Nginx[üîí Nginx + SSL/TLS<br/>Port 443]
    end

    subgraph "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"
        Gateway[üõ°Ô∏è API Gateway<br/>Port 30002<br/>Rate Limiting<br/>Helmet.js<br/>JWT Validation]
    end

    subgraph "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
        Frontend[‚öõÔ∏è React Frontend<br/>Port 3000<br/>TypeScript + Vite<br/>Tailwind CSS]
        Backend[üîß Node.js Backend<br/>Port 3001<br/>Express + Prisma<br/>Socket.IO]
        Docs[üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è<br/>Port 3002]
    end

    subgraph "–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"
        PostgreSQL[(üóÑÔ∏è PostgreSQL 15+<br/>Port 5432)]
        Redis[(‚ö° Redis 7+<br/>Port 6379)]
    end

    subgraph "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"
        Sentry[üìä Sentry<br/>Error Tracking]
    end

    Browser -->|HTTPS| Nginx
    Nginx -->|Proxy| Gateway
    Gateway --> Backend
    Gateway --> Frontend
    Gateway --> Docs

    Backend --> PostgreSQL
    Backend --> Redis
    Backend --> Sentry
    Frontend -->|WebSocket| Backend

    style Gateway fill:#ff6b6b
    style Backend fill:#4ecdc4
    style Frontend fill:#45b7d1
    style PostgreSQL fill:#95e1d3
    style Redis fill:#f38181
            </div>

            <div class="info-box">
                <h3>–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã</h3>
                <ul>
                    <li>API Gateway –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</li>
                    <li>–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º frontend –∏ backend</li>
                    <li>Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–µ–∞–ª-—Ç–∞–π–º —Ñ—É–Ω–∫—Ü–∏–π —á–µ—Ä–µ–∑ Socket.IO</li>
                    <li>PostgreSQL —Å Prisma ORM –¥–ª—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏</li>
                    <li>Sentry –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</li>
                    <li>PM2 –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏</li>
                </ul>
            </div>

            <div class="metrics">
                <div class="metric-card">
                    <div class="label">–¶–µ–ª–µ–≤–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</div>
                    <div class="number">&lt; 200ms</div>
                </div>
                <div class="metric-card">
                    <div class="label">–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</div>
                    <div class="number">99.9%</div>
                </div>
                <div class="metric-card">
                    <div class="label">–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    <div class="number">1000+</div>
                </div>
                <div class="metric-card">
                    <div class="label">–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏</div>
                    <div class="number">&gt; 80%</div>
                </div>
            </div>
        </div>

        <!-- Data Flow Diagram -->
        <div id="dataflow" class="diagram-container">
            <h2>–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h2>
            <div class="mermaid">
sequenceDiagram
    participant User as üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant Nginx as üîí Nginx
    participant GW as üõ°Ô∏è Gateway
    participant BE as üîß Backend
    participant DB as üóÑÔ∏è PostgreSQL
    participant Cache as ‚ö° Redis

    User->>Nginx: HTTPS Request
    Nginx->>GW: Proxy to localhost:30002

    GW->>GW: ‚úì Rate Limiting
    GW->>GW: ‚úì Security Headers
    GW->>BE: Forward Request

    BE->>Cache: Check Cache
    alt Cache Hit
        Cache-->>BE: Return Data
    else Cache Miss
        BE->>DB: Query Database
        DB-->>BE: Return Data
        BE->>Cache: Update Cache
    end

    BE-->>GW: Response
    GW-->>Nginx: Response
    Nginx-->>User: HTTPS Response

    Note over User,BE: WebSocket –¥–ª—è —Ä–µ–∞–ª-—Ç–∞–π–º
    User->>BE: WebSocket Connection
    BE->>Cache: Pub/Sub Subscribe
    Cache-->>BE: Real-time Event
    BE-->>User: Push Update
            </div>

            <div class="info-box">
                <h3>–ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞</h3>
                <ul>
                    <li>–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ Nginx —Å SSL —Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–µ–π</li>
                    <li>Gateway –ø—Ä–æ–≤–µ—Ä—è–µ—Ç rate limits –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç security headers</li>
                    <li>Backend —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Redis –∫—ç—à –ø–µ—Ä–µ–¥ –æ–±—Ä–∞—â–µ–Ω–∏–µ–º –∫ –ë–î</li>
                    <li>WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç Redis Pub/Sub –¥–ª—è —Ä–µ–∞–ª-—Ç–∞–π–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π</li>
                    <li>–í—Å–µ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ Sentry</li>
                </ul>
            </div>
        </div>

        <!-- Security Diagram -->
        <div id="security" class="diagram-container">
            <h2>–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h2>
            <div class="mermaid">
graph TB
    Internet[üåç –ò–Ω—Ç–µ—Ä–Ω–µ—Ç]

    subgraph "Firewall Layer"
        IPTables[üî• iptables/pfctl<br/>DROP all INPUT<br/>ALLOW localhost<br/>ALLOW :443<br/>ALLOW :30002 from localhost]
    end

    subgraph "SSL/TLS Layer"
        Certbot[üîê Let's Encrypt SSL<br/>Auto-renewal<br/>HTTPS only]
    end

    subgraph "Application Security"
        GatewaySec[üõ°Ô∏è Gateway Security<br/>Rate Limit: 100/15min<br/>Helmet.js<br/>CORS<br/>Input Validation]

        BackendSec[üîí Backend Security<br/>JWT Auth<br/>bcrypt<br/>Prisma ORM<br/>XSS Protection]
    end

    Internet -->|HTTPS| IPTables
    IPTables -->|:443| Certbot
    Certbot -->|SSL| GatewaySec
    GatewaySec -->|localhost| BackendSec

    style IPTables fill:#ff6b6b
    style Certbot fill:#feca57
    style GatewaySec fill:#ff9ff3
    style BackendSec fill:#48dbfb
            </div>

            <div class="info-box">
                <h3>–£—Ä–æ–≤–Ω–∏ –∑–∞—â–∏—Ç—ã</h3>
                <ul>
                    <li><strong>–°–µ—Ç–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å:</strong> Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫—Ä–æ–º–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö</li>
                    <li><strong>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å:</strong> SSL/TLS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞</li>
                    <li><strong>Application —É—Ä–æ–≤–µ–Ω—å:</strong> Rate limiting, JWT auth, input validation</li>
                    <li><strong>–£—Ä–æ–≤–µ–Ω—å –¥–∞–Ω–Ω—ã—Ö:</strong> SQL injection –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ Prisma, bcrypt –¥–ª—è –ø–∞—Ä–æ–ª–µ–π</li>
                </ul>
            </div>

            <h3>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤</h3>
            <table>
                <thead>
                    <tr>
                        <th>–°–µ—Ä–≤–∏—Å</th>
                        <th>–ü–æ—Ä—Ç</th>
                        <th>–î–æ—Å—Ç—É–ø</th>
                        <th>–ó–∞—â–∏—Ç–∞</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Nginx</td>
                        <td>443</td>
                        <td><span class="badge danger">–í–Ω–µ—à–Ω–∏–π</span></td>
                        <td>SSL/TLS, Firewall</td>
                    </tr>
                    <tr>
                        <td>Gateway</td>
                        <td>30002</td>
                        <td><span class="badge success">localhost only</span></td>
                        <td>Rate Limit, Helmet</td>
                    </tr>
                    <tr>
                        <td>Backend</td>
                        <td>3001</td>
                        <td><span class="badge success">localhost only</span></td>
                        <td>JWT, Validation</td>
                    </tr>
                    <tr>
                        <td>Frontend</td>
                        <td>3000</td>
                        <td><span class="badge success">localhost only</span></td>
                        <td>CORS</td>
                    </tr>
                    <tr>
                        <td>PostgreSQL</td>
                        <td>5432</td>
                        <td><span class="badge success">localhost only</span></td>
                        <td>Password, Firewall</td>
                    </tr>
                    <tr>
                        <td>Redis</td>
                        <td>6379</td>
                        <td><span class="badge success">localhost only</span></td>
                        <td>Password, Firewall</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Deployment Diagram -->
        <div id="deployment" class="diagram-container">
            <h2>–ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–∞ –∏ CI/CD</h2>
            <div class="mermaid">
graph LR
    Dev[üíª Development]
    GitHub[üì¶ GitHub]
    Actions[‚öôÔ∏è GitHub Actions<br/>Lint + Test + Build]

    subgraph "Deployment Options"
        Docker[üê≥ Docker Compose]
        PM2[üîÑ PM2 Cluster]
        Cloud[‚òÅÔ∏è Cloud Platforms]
    end

    subgraph "Production"
        Nginx[Nginx]
        App[Applications]
        DB[(Databases)]
    end

    Dev -->|git push| GitHub
    GitHub -->|trigger| Actions
    Actions -->|success| Docker
    Actions -->|success| PM2
    Actions -->|success| Cloud

    Docker --> Nginx
    PM2 --> Nginx
    Cloud --> Nginx

    Nginx --> App
    App --> DB
            </div>

            <div class="tech-stack">
                <div class="tech-card">
                    <h4>üê≥ Docker Deployment</h4>
                    <ul>
                        <li>docker-compose.yml</li>
                        <li>Multi-container setup</li>
                        <li>Health checks</li>
                        <li>Volume persistence</li>
                        <li>Network isolation</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üîÑ PM2 Deployment</h4>
                    <ul>
                        <li>ecosystem.config.js</li>
                        <li>Cluster mode</li>
                        <li>Auto-restart</li>
                        <li>Log management</li>
                        <li>Max instances</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>‚òÅÔ∏è Cloud Deployment</h4>
                    <ul>
                        <li>Railway (auto-deploy)</li>
                        <li>Vercel (frontend)</li>
                        <li>Heroku (full-stack)</li>
                        <li>AWS ECS/EB</li>
                        <li>GCP Cloud Run</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>‚öôÔ∏è CI/CD Pipeline</h4>
                    <ul>
                        <li>Automated linting</li>
                        <li>Unit & integration tests</li>
                        <li>Security audit</li>
                        <li>Build verification</li>
                        <li>Auto-deployment</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Scaling Diagram -->
        <div id="scaling" class="diagram-container">
            <h2>–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
            <div class="mermaid">
graph TB
    LB[‚öñÔ∏è Load Balancer]

    subgraph "Gateway Layer"
        GW1[Gateway 1]
        GW2[Gateway 2]
    end

    subgraph "Backend Layer"
        BE1[Backend 1]
        BE2[Backend 2]
        BE3[Backend 3]
    end

    subgraph "Data Layer"
        Primary[(PostgreSQL Primary)]
        Replica[(PostgreSQL Replica)]
        RedisCluster[Redis Cluster<br/>3 masters + 3 replicas]
    end

    LB --> GW1
    LB --> GW2

    GW1 --> BE1
    GW1 --> BE2
    GW2 --> BE2
    GW2 --> BE3

    BE1 --> Primary
    BE2 --> Replica
    BE3 --> Replica

    BE1 --> RedisCluster
    BE2 --> RedisCluster
    BE3 --> RedisCluster

    style LB fill:#48dbfb
    style Primary fill:#95e1d3
    style RedisCluster fill:#f38181
            </div>

            <div class="info-box">
                <h3>–°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                <ul>
                    <li><strong>Gateway:</strong> 2+ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞</li>
                    <li><strong>Backend:</strong> PM2 cluster mode —Å max instances (–ø–æ —á–∏—Å–ª—É CPU cores)</li>
                    <li><strong>PostgreSQL:</strong> Master-Replica —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–ª—è read scaling</li>
                    <li><strong>Redis:</strong> Cluster setup —Å 3 –º–∞—Å—Ç–µ—Ä–∞–º–∏ –∏ 3 —Ä–µ–ø–ª–∏–∫–∞–º–∏</li>
                    <li><strong>Load Balancer:</strong> Nginx –∏–ª–∏ –æ–±–ª–∞—á–Ω—ã–π LB –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏</li>
                </ul>
            </div>
        </div>

        <!-- Technology Stack -->
        <div id="tech" class="diagram-container">
            <h2>–ü–æ–ª–Ω—ã–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫</h2>

            <div class="tech-stack">
                <div class="tech-card">
                    <h4>‚öõÔ∏è Frontend</h4>
                    <ul>
                        <li>React 18</li>
                        <li>TypeScript</li>
                        <li>Vite (build tool)</li>
                        <li>Tailwind CSS</li>
                        <li>React Router</li>
                        <li>Axios</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üîß Backend</h4>
                    <ul>
                        <li>Node.js 18+</li>
                        <li>Express.js</li>
                        <li>Prisma ORM</li>
                        <li>Socket.IO</li>
                        <li>JWT Auth</li>
                        <li>bcrypt</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üóÑÔ∏è Databases</h4>
                    <ul>
                        <li>PostgreSQL 15+</li>
                        <li>Redis 7+</li>
                        <li>Prisma Migrations</li>
                        <li>Connection Pooling</li>
                        <li>Pub/Sub messaging</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üõ°Ô∏è Security</h4>
                    <ul>
                        <li>Helmet.js</li>
                        <li>Express Rate Limit</li>
                        <li>iptables/pfctl</li>
                        <li>Let's Encrypt SSL</li>
                        <li>CORS</li>
                        <li>Input Validation</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üìä Monitoring</h4>
                    <ul>
                        <li>Sentry</li>
                        <li>PM2 Monitoring</li>
                        <li>Health Checks</li>
                        <li>Access Logs</li>
                        <li>Error Tracking</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üöÄ DevOps</h4>
                    <ul>
                        <li>Docker & Docker Compose</li>
                        <li>PM2 Process Manager</li>
                        <li>Nginx</li>
                        <li>GitHub Actions</li>
                        <li>Automated Testing</li>
                    </ul>
                </div>
            </div>

            <div class="mermaid">
graph TB
    subgraph "Frontend Layer"
        React[React + TypeScript]
        Vite[Vite]
        Tailwind[Tailwind CSS]
    end

    subgraph "Backend Layer"
        Express[Express.js]
        Prisma[Prisma ORM]
        SocketIO[Socket.IO]
    end

    subgraph "Database Layer"
        Postgres[PostgreSQL]
        RedisDB[Redis]
    end

    subgraph "Infrastructure"
        Docker[Docker]
        PM2[PM2]
        Nginx[Nginx]
    end

    React --> Express
    Express --> Prisma
    Prisma --> Postgres
    Express --> RedisDB
    SocketIO --> RedisDB

    Docker -.contains.-> Express
    PM2 -.manages.-> Express
    Nginx -.proxies.-> Express
            </div>
        </div>

        <!-- Ports and Access -->
        <div id="ports" class="diagram-container">
            <h2>–ü–æ—Ä—Ç—ã, –¥–æ—Å—Ç—É–ø –∏ endpoints</h2>

            <h3>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤</h3>
            <table>
                <thead>
                    <tr>
                        <th>–°–µ—Ä–≤–∏—Å</th>
                        <th>–ü–æ—Ä—Ç</th>
                        <th>–î–æ—Å—Ç—É–ø</th>
                        <th>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>üîí Nginx (HTTPS)</td>
                        <td>443</td>
                        <td><span class="badge danger">–í–Ω–µ—à–Ω–∏–π</span></td>
                        <td>–û—Å–Ω–æ–≤–Ω–æ–π –≤—Ö–æ–¥ –≤ production</td>
                    </tr>
                    <tr>
                        <td>üîí Nginx (HTTP)</td>
                        <td>80</td>
                        <td><span class="badge warning">–í–Ω–µ—à–Ω–∏–π</span></td>
                        <td>–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS</td>
                    </tr>
                    <tr>
                        <td>üõ°Ô∏è API Gateway</td>
                        <td>30002</td>
                        <td><span class="badge success">localhost</span></td>
                        <td>–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞</td>
                    </tr>
                    <tr>
                        <td>‚öõÔ∏è React Frontend</td>
                        <td>3000</td>
                        <td><span class="badge success">localhost</span></td>
                        <td>Dev server / Static files</td>
                    </tr>
                    <tr>
                        <td>üîß Backend API</td>
                        <td>3001</td>
                        <td><span class="badge success">localhost</span></td>
                        <td>REST API + WebSocket</td>
                    </tr>
                    <tr>
                        <td>üìö Documentation</td>
                        <td>3002</td>
                        <td><span class="badge success">localhost</span></td>
                        <td>Interactive API docs</td>
                    </tr>
                    <tr>
                        <td>üóÑÔ∏è PostgreSQL</td>
                        <td>5432</td>
                        <td><span class="badge success">localhost</span></td>
                        <td>Main database</td>
                    </tr>
                    <tr>
                        <td>‚ö° Redis</td>
                        <td>6379</td>
                        <td><span class="badge success">localhost</span></td>
                        <td>Cache + Pub/Sub</td>
                    </tr>
                </tbody>
            </table>

            <h3>–û—Å–Ω–æ–≤–Ω—ã–µ API Endpoints</h3>
            <div class="tech-stack">
                <div class="tech-card">
                    <h4>üîê Authentication</h4>
                    <ul>
                        <li>POST /api/auth/register</li>
                        <li>POST /api/auth/login</li>
                        <li>POST /api/auth/logout</li>
                        <li>GET /api/auth/profile</li>
                        <li>PUT /api/auth/profile</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üìù Habits</h4>
                    <ul>
                        <li>GET /api/habits</li>
                        <li>POST /api/habits</li>
                        <li>GET /api/habits/:id</li>
                        <li>PUT /api/habits/:id</li>
                        <li>DELETE /api/habits/:id</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üìä KPI</h4>
                    <ul>
                        <li>GET /api/kpi</li>
                        <li>GET /api/kpi/calculate</li>
                        <li>GET /api/kpi/history</li>
                        <li>GET /api/kpi/trends</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üë• Teams</h4>
                    <ul>
                        <li>GET /api/teams</li>
                        <li>POST /api/teams</li>
                        <li>GET /api/teams/:id</li>
                        <li>POST /api/teams/:id/invite</li>
                        <li>DELETE /api/teams/:id</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üîç Monitoring</h4>
                    <ul>
                        <li>GET /api/health</li>
                        <li>GET /api/health/detailed</li>
                        <li>GET /health (Gateway)</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üîå WebSocket Events</h4>
                    <ul>
                        <li>habit:created</li>
                        <li>habit:updated</li>
                        <li>kpi:calculated</li>
                        <li>team:updated</li>
                    </ul>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>KPI Productivity GitHub Release</strong></p>
            <p>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–∏—Å—Ç–µ–º—ã | v1.0.0 | 2026-01-13</p>
            <p style="margin-top: 10px; opacity: 0.8;">–°–æ–∑–¥–∞–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Mermaid.js</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        function showDiagram(diagramId) {
            // Hide all diagrams
            document.querySelectorAll('.diagram-container').forEach(container => {
                container.classList.remove('active');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected diagram
            document.getElementById(diagramId).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
